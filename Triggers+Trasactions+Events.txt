>>>>>>>>>>>>>>>>>>>>>>>>>Triggers<<<<<<<<<<<<<<<<<<<<<<<<


------------Departments_Db--------------

1)Triggers for generating orders
  N triggers (1 for each item in department) that activates when 'Current Positions' table of department updates and if 'Limits.Min' is more than new 'Current_Positions.Count' for tracked item, then creates new entry in 'Positions To Buy' table where 'Id' = 'Tracked Item Id' and 'Count To Buy' = 'Limits.Max' - 'Current_Positions.Count' (in case if there is no such position for this moment, otherwise updates 'Count To Buy')

2)Trigger for sending order
 1 trigger for each department that tracking updates of 'Positions To Buy' number of entries and if its more than set limit (set by editor) then send message to Kafka for 'Tasking Manager' to convert created order to .xls, save it on server, create description for it, add entry with 'Order Link', 'Description', 'Department' to 'Orders' table, and clear 'Positions To Buy'


------------Global_Db--------------

1)Triggers for updating average limits
 N triggers (1 for each unique item in whole system) that activates when 'Limits' table of any Department updates/has new entry, check if its limits refers to tracked position and if they're, then updates 'Global_Db.Limits' for tracked position (takes all updated/added limits from 'Deparment_Db', as well as all limits from 'Global_Db' for the tracked position and if the time limits of the limits match, then updates the values in 'Global_Db', as: Num_Vals += 1, Avg_Min = (Avg_Min + 'new/updated Min') / Num_Vals, Avg_Max = (Avg_Max + 'new/updated Max') / Num_Vals, otherwise it finds whether the time limits of the new 'Departments_Db'limits are included in those in 'Global_Db' or not, if so, it calculates the average values as: Num_Vals += 1, Avg_Min = (Avg_Min + ('new/updated Min'_1 + ... 'new/updated Min'_k)/k)/Num_Vals, Avg_Max = (Avg_Max + ('new/updated Max'_1 + ... 'new/updated Max'_k)/k)/Num_Vals, otherwise - creates new limits based on new limits from the 'Department_Db'(while combining the limits that do not overlap with the limits in 'Global_Db' as much as possible as: Num_Vals = k (count of limits to combine), Avg_Min = ('new/updated Min'_1 + ... + 'new/updated Min'_k)/Num_Vals, Avg_Max = ('new/updated Max'_1 + ... + 'new/updated Max'_k)/Num_Vals, Start_Date = min('new/update Limits'.Start_Date), End_Date = max('new/update Limits'.End_Date)))




>>>>>>>>>>>>>>>>>>>>>>>>>>Events<<<<<<<<<<<<<<<<<<<<<<<<<


------------Departments_Db--------------

1)Events for updating orders generating triggers
 N events (1 for each item) that are activated when the limit for the monitored item expires are found in 'Department_Db.Limits' limit for this item whose expiration date includes the current date and changes the value in the trigger. After that, it corrects its own trigger date to the one specified as 'End_Date' at the limit that was used to update the trigger.




>>>>>>>>>>>>>>>>>>>>>>>Transactions<<<<<<<<<<<<<<<<<<<<<<



------------Departments_Db--------------

1)Transaction for editing 'Position Attributes'
 Transaction that has the following optional parameters:'Position To', 'Attribute Name', New 'Attribute Name', New 'Value', 'Delete Marker'. if the parameters 'Position To' (for creation only, can't be edited), 'Attribute Name' and new 'Value' were passed, then the transaction changes the value of the attribute with the passed name, or creates a new attribute if there was no attribute with that name before. If all 3 parameters (or 4 + 'Position To' for creation only) were passed, the transaction changes the 'Attribute Name' to new 'Attribute Name', as well as 'Value' to new 'Value' if the specified attribute previously existed, otherwise it creates a new attribute with the specified name (new 'Attribute Name') and value - new 'Value'. If 3 parameters were passed - 'Position To', new 'Attribute Name' and new 'Value', then the transaction should try to create a new attribute with the specified values, but should not change something if an attribute with the specified name already exists. if the parameters 'Attribute Name' and 'Delete Marker' where passed then transaction should try to delete record with specified 'Attribute Name'. In all other combinations of parameters, the transaction should not perform any actions.

2)Transaction for editing 'Limits'
 Transaction that has the following optional parameters: 'ID', 'Position To', 'Max', 'Min', 'Start Date', 'End Date', 'Delete Marker'. If the parameters 'Position To', 'Max', 'Min', 'Start Date', 'End Date' were passed, then the transaction must create a new limit with the values passed, if the parameter 'ID' and one or more parameters 'Max', 'Min', 'Start Date' were passed', 'End Date' in any of their combinations, then the transaction must make changes to the transmitted values if the limit with 'ID' exists. if the parameters 'ID' and 'Delete Marker' where passed then transaction should try to delete record with specified 'ID'.In all other combinations of parameters, the transaction should not perform any actions.

3)Transaction for editing 'Current Positions'
 Transaction that has the following optional parameters: 'ID', 'Name', 'Count', 'Delete Marker'. If the parameters 'Name' and 'Count' were passed, then the transaction should create a new record with the values passed, if the parameter 'ID' was passed with one or both parameters 'Name' and 'Count', then the transaction should change the record with the specified 'ID' to the values passed. if the parameters 'ID' and 'Delete Marker' where passed then transaction should try to delete record with specified 'ID'. In all other combinations of parameters, the transaction should not perform any actions.

4)Transaction for editing 'Positions To Buy'
 Transaction without parameters, the sole purpose of which is to clear "Purchase Positions" at the request of the "Task Manager".

------------Global_Db--------------

1)Transaction for editing 'Unique Positions'
 Transaction that has the following optional parameters: 'ID', 'Name'. If the parameters 'ID' and 'Name' were passed, then the transaction should change the record with the specified 'ID' to the received value, if the parameter 'Name' was passed, then the transaction should create a new record. In all other combinations of parameters, the transaction should not perform any actions.

2)Transaction for editing 'Positions Attributes'
 Transaction that has the following optional parameters: 'Position To', 'Attribute Name', New 'Attribute Name', New 'Value', 'Delete Marker'. if the parameters 'Position To' (for creation only, can't be edited), 'Attribute Name' and new 'Value' were passed, then the transaction changes the value of the attribute with the passed name, or creates a new attribute if there was no attribute with that name before. If all 3 parameters (or 4 + 'Position To' for creation only) were passed, the transaction changes the 'Attribute Name' to new 'Attribute Name', as well as 'Value' to new 'Value' if the specified attribute previously existed, otherwise it creates a new attribute with the specified name (new 'Attribute Name') and value - new 'Value'. If 3 parameters were passed - 'Position To', new 'Attribute Name' and new 'Value', then the transaction should try to create a new attribute with the specified values, but should not change something if an attribute with the specified name already exists. if the parameters 'Attribute Name' and 'Delete Marker' where passed then transaction should try to delete record with specified 'Attribute Name'. In all other combinations of parameters, the transaction should not perform any actions.

3)Transaction for editing 'Limits'
 Transaction that has the following optional parameters: 'Position To', 'ID', 'Min', 'Max', 'Start Date', 'End Date', 'Delete Marker'. If the parameters 'Position To', 'Min', 'Max', 'Start Date', 'End Date' were passed, then the transformation should create a new record in which 'Avg_Min' = 'Min', 'Avg_Max' = 'Max', 'Num_Vals' = 1, and the dates are equal to the passed parameters with the corresponding names, if the parameters 'ID', 'Min', 'Max' were passed, then the transaction should change the record with the corresponding 'ID' as follows: 'Num_Vals' += 1, 'Avg_Min' = (Avg_Min + Min)/Num_Vals, 'Avg_Max' = (Avg_Max + Max)/Num_Vals . if the parameters 'ID' and 'Delete Marker' where passed then transaction should try to delete record with specified 'ID'. In all other combinations of parameters, the transaction should not perform any actions. 

------------Logins+Files_Db--------------

1)Transaction for editing 'Users'
 Transaction that has the following optional parameters:'Nickname', 'Role', 'Department'(array in this case), 'Password', 'Delete Marker';as well as these required parameters: 'Login'. If a required parameter and any of the optional parameters were passed in any combinations (except those with all parameters and everything except the password), the trigger must edit the entry with the specified 'Login' if it exists, otherwise do nothing. If all possible parameters were passed, or all except 'Password', then the trigger should either edit the entry with the specified 'Login', or create a new one, if there is not one yet. if the parameters 'Login' and 'Delete Marker' where passed then transaction should try to delete record with specified 'Login'. In all other combinations of parameters, the transaction should not perform any actions.

2)Transaction for editing 'Department Names'
 Transaction that has the following optional parameters:'Name', 'Working Marker', New 'Name', 'Delete Marker'. If only the 'Name' parameter was passed, then the transaction should create a new record with the specified name and the value 'Working Marker' = true, or do nothing if it already exists, if the parameters 'Name' and one of or both parameters 'Working Marker' and New 'Name' were passed. then the transaction must change the record with the specified 'Name' or create a new record if both parameters 'Working Marker' and New 'Name' were passed, or only New 'Name'. If the parameter New 'Name' was passed (and optionally 'Working Marker'), then it is necessary to create a new record if a record with such a 'Name' does not exist yet, otherwise do nothing. if the parameters 'Name' and 'Delete Marker' where passed then transaction should try to delete record with specified 'Name'. In all other combinations of parameters, the transaction should not perform any actions.

3)Transaction for editing 'Supply Data'
 Transaction that has the following optional parameters:'Name', 'Department'(Array in this case), 'Working Marker', 'Delete Marker' ;as well as these required parameters: 'email'. If the parameters 'email', 'Name', 'Department' were passed, then the transaction must create a new record with the specified data, or edit an existing one, if the parameter 'email' and any other parameters were passed in any combinations (except described), then the transaction must edit the record with the specified 'email', or do nothing if such a record does not exist. if the parameters 'email' and 'Delete Marker' where passed then transaction should try to delete record with specified 'email'. In all other combinations of parameters, the transaction should not perform any actions.

4)Transaction for editing 'Complaints/Replies'
  Transaction that has the following optional parameters: 'ID', 'Theme', 'Complaint', 'Reply', 'Recipient(Role)', 'Recipient', 'Sender(Department)', 'Sender', 'Read Marker', 'Closed Marker'. if 'Theme', 'Complaint', 'Sender(Department)', 'Sender' and 'Recipient(Role)' (or 'Recipient' in the case of a specific recipient) were passed', then the transaction should create a new record. If 'ID', 'Reply', 'Recipient' were passed, then the transaction should edit the corresponding parameters if a record with the specified 'ID' exists or do nothing otherwise. If the parameters 'ID', 'Complaint' were passed, then the transaction should change the corresponding record, if it exists. If 'ID' and 'Closed Marker' were passed, then the transaction should edit the corresponding parameter for the record, if it exists. If 'ID' and 'Read Marker' were passed, then the transaction should change this parameter for the corresponding record. In all other combinations of parameters, the transaction should not perform any actions.

5)Transaction for editing 'Orders'
 Transaction that has the following optional parameters: 'Department', 'Read Marker(D.P.)', 'Read Marker(Editor)', 'Edited Marker', 'Verified Marker', 'Bad Order Marker', 'Done Order Marker', 'Description', 'Complaint Description', 'Sender', 'Sent To', 'Edited by', 'Complaint by', 'Done by';as well as these required parameters: 'Link to File'. if the parameters 'Link To File', 'Department', 'Description' were passed, then the transaction should create a new record if there are no records with such a 'Link To File', otherwise do nothing. If 'Link To File', 'Edited Marker', 'Edited by' were passed, then the transaction should edit the corresponding parameter of the record with the received 'Link To File', if such exists. If 'Link To File', 'Verified Marker', 'Sender' were passed, then the transaction should edit the corresponding record, if such exists. If 'Link To File', 'Read Marker' (any of the two, but not two at once) were passed, then the transaction should edit the corresponding record, if such exists. If 'Link To File', 'Done Order Marker', 'Sent to', 'Done by' were passed, then the transaction must edit the corresponding parameters if the record with the specified 'Link To File' exists. If 'Link To File', 'Complaint Description', 'Bad Order Marker', 'Complained by' were passed, then the transaction must edit the corresponding record if it exists. If 'Link To File', 'Edited by', 'Edited Marker', 'Bad Order Marker', 'Description' were passed, then the transaction must change the corresponding fields if the entry with the specified 'Link To File' exists . In all other combinations of parameters, the transaction should not perform any actions.


6)Transaction for editing 'Loaded Data'
 Transaction that has the following optional parameters:'Department', 'Sender', 'Document Type', 'Delete Marker' ;as well as these required parameters: 'Link to File'. if all parameters have been passed, then the transaction should create a new record with the received values, if there are no records with such a 'Link to File' yet, otherwise edit the record with the passed 'Link to File'. If 'Link to File' and any of the possible parameters were passed in any combination (excluding the one already described), then the transaction must change the record with the specified 'Link to File', or do nothing if such a record does not exist. if the parameters 'Link to File' and 'Delete Marker' where passed then transaction should try to delete record with specified 'Link to File'. In all other combinations of parameters, the transaction should not perform any actions.

7)Transaction for editing 'Positions Data'
 Transaction that has the following optional parameters:'ID', 'Name', 'Document To', 'Unique', 'Count', 'Edited Marker', 'Processed Marker', 'Edited by', 'Processed by', 'Delete Marker'. if the parameters 'Name', 'Document To', 'Unique', 'Count' were passed (or all of the above + 'Edited Marker', 'Processed Marker', 'Edited by', 'Processed by'), then the transaction should create a new record. If the 'ID' parameter and any other parameters (excluding 'Document To') were passed in any combination, then the transaction must change the record with the corresponding 'ID', or do nothing if one does not exist. if the parameters 'ID' and 'Delete Marker' where passed then transaction should try to delete record with specified 'ID'. In all other combinations of parameters, the transaction should not perform any actions.

8)Transaction for editing 'Position Attributes'
 Transaction that has the following optional parameters:'Position To', 'Attribute Name', New 'Attribute Name', New 'Value', 'Delete Marker'. if the parameters 'Position To' (for creation only, can't be edited), 'Attribute Name' and new 'Value' were passed, then the transaction changes the value of the attribute with the passed name, or creates a new attribute if there was no attribute with that name before. If all 3 parameters (or 4 + 'Position To' for creation only) were passed, the transaction changes the 'Attribute Name' to new 'Attribute Name', as well as 'Value' to new 'Value' if the specified attribute previously existed, otherwise it creates a new attribute with the specified name (new 'Attribute Name') and value - new 'Value'. If 3 parameters were passed - 'Position To', new 'Attribute Name' and new 'Value', then the transaction should try to create a new attribute with the specified values, but should not change something if an attribute with the specified name already exists. if the parameters 'Attribute Name' and 'Delete Marker' where passed then transaction should try to delete record with specified 'Attribute Name'. In all other combinations of parameters, the transaction should not perform any actions.

9)Transaction for editing 'Limits'
 Transaction that has the following optional parameters: 'ID', 'Position To', 'Max', 'Min', 'Start Date', 'End Date', 'Delete Marker'. If the parameters 'Position To', 'Max', 'Min', 'Start Date', 'End Date' were passed, then the transaction must create a new limit with the values passed, if the parameter 'ID' and one or more parameters 'Max', 'Min', 'Start Date' were passed', 'End Date' in any of their combinations, then the transaction must make changes to the transmitted values if the limit with 'ID' exists. if the parameters 'ID' and 'Delete Marker' where passed then transaction should try to delete record with specified 'ID'.In all other combinations of parameters, the transaction should not perform any actions.